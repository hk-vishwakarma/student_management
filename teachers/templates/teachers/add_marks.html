{% extends 'base.html' %}
{% block content %}
<!DOCTYPE html>
<html>

<head>
    <title>Add Marks</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

    <div class="container mt-5">

        <h3 class="mb-4">üìù Add Student Marks</h3>

        {% if messages %}
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
        {% endif %}

        <!-- FILTER -->
        <form method="GET" class="row g-3 mb-4">
            <div class="col-md-3">
                <select name="class_id" class="form-select" onchange="this.form.submit()" required>
                    <option value="">Select Class</option>
                    {% for cls in classes %}
                    <option value="{{ cls.id }}"
                     {% if selected_class and cls.id == selected_class.id %}selected{% endif %}>
                        {{ cls.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-3">
                <select name="subject_id" class="form-select"  required>
                    <option value="">Select Subject</option>
                    {% for sub in subjects %}
                    <option value="{{ sub.id }}"
                    {% if selected_subject and sub.id == selected_subject.id %}selected{%endif%}>
                        
                        {{ sub.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-3">
                <select name="exam_id" class="form-select" required>
                    <option value="">Select Exam</option>
                    {% for exam in exams %}
                    <option value="{{ exam.id }}"
                    {% if selected_exam and exam.id == selected_exam.id %}selected{%endif%}>
                    {{ exam.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-3">
                <button class="btn btn-primary w-100">Load Students</button>
            </div>
        </form>

        {% if students %}
        <form method="POST">
            {% csrf_token %}
            <input type="hidden" name="class_id" value="{{ selected_class.id }}">
            <input type="hidden" name="subject_id" value="{{ request.GET.subject_id }}">
            <input type="hidden" name="exam_id" value="{{ request.GET.exam_id }}">

            <table class="table table-bordered text-center">
                <thead class="table-dark">
                    <tr>
                        <th>Roll No</th>
                        <th>Name</th>
                        <th>Marks Obtained</th>
                        <th>Max Marks</th>
                    </tr>
                </thead>
                <tbody>
                    {% for student in students %}
                    <tr>
                        <td>{{ student.roll_no }}</td>
                        <td>{{ student.full_name }}</td>
                        <td>
                            <input type="number" name="marks_{{ student.id }}" class="form-control" step="0.5" min="0">
                        </td>
                        <td>
                            <input type="number" name="max_marks" class="form-control" step="0.5" min="0">
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <div class="text-end">
                <button class="btn btn-success px-4">Save Marks</button>
            </div>
        </form>
        {% endif %}

    </div>

</body>

</html>{%endblock%}